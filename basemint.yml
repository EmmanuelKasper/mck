    - name: download mint {{ version }} distribution
      get_url:
        url: "https://bintray.com/freemint/freemint/download_file?file_path=snapshots%2F{{ major_version }}-{{ commit_hash }}%2Ffreemint-{{ major_version }}-{{ minor_version }}-000-st_ste.zip"
        dest: "{{ playbook_dir }}/freemint-{{ version }}-000-st_ste.zip"
        force: no

    - name: create folder structure
      file:
        path: "{{ item }}"
        state: directory
      loop:
        - freemint
        - build/auto
        - build/extra
        - resources/etherne/

    - name: unpack freemint archive
      unarchive:
        src: freemint-{{ version }}-000-st_ste.zip
        dest: freemint
        creates: freemint/auto/mint-{{ minor_version }}.prg

    - name: copy freemint kernel
      copy:
        src: freemint/auto/mint-{{ minor_version }}.prg
        dest: build/auto/mint-{{ minor_version }}.prg

    - name : copy freemint sysdir
      command: cp -r freemint/mint build/
      args:
        creates: build/mint

    - name: remove default hostname
      replace:
        path: "build/mint/{{ version }}/mint.cnf"
        regexp : '^setenv HOSTNAME saturn$'
        replace: 'setenv HOSTNAME stmint'

    - name: disable {{ item }} driver
      command: mv build/mint/{{ version }}/{{ item }}.xfs build/mint/{{ version }}/{{ item }}.xfx
      args:
        creates: build/mint/{{ version }}/{{ item }}.xfx
      loop:
        - ext2
        - nfs

    - name: download ethernec driver
      get_url:
        url: http://web222.webclient5.de/prj/atari/download/etherne.zip
        dest: resources/etherne.zip
        force: no

    - name: unarchive ethernec driver
      unarchive:
        src: resources/etherne.zip
        dest: resources/etherne/
        creates: resources/etherne/ENEC.MIF

    - name: fix ethernet driver file permissions
      file:
        path: resources/etherne/ENEC.MIF
        mode: '0644'

    - name: copy ethernec driver to mint folder but leaves it disabled
      command: cp resources/etherne/ENEC.MIF build/mint/{{ version }}/enec.xix
      args:
        creates: build/mint/{{ version }}/enec.xix
